# å°æ™º ESP32 å¼€å‘ç¯å¢ƒæ­å»ºæŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä»é›¶å¼€å§‹æ­å»ºå°æ™º AI èŠå¤©æœºå™¨äººçš„å¼€å‘ç¯å¢ƒã€‚

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [å¼€å‘å·¥å…·å®‰è£…](#å¼€å‘å·¥å…·å®‰è£…)
3. [ESP-IDF ç¯å¢ƒé…ç½®](#esp-idf-ç¯å¢ƒé…ç½®)
4. [é¡¹ç›®å…‹éš†ä¸é…ç½®](#é¡¹ç›®å…‹éš†ä¸é…ç½®)
5. [ç¼–è¯‘ä¸çƒ§å½•](#ç¼–è¯‘ä¸çƒ§å½•)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚

### æ¨èé…ç½®

- **æ“ä½œç³»ç»Ÿ**: 
  - âœ… **Linux (Ubuntu/Debian)** - æ¨èï¼Œç¼–è¯‘é€Ÿåº¦å¿«ï¼Œæ— é©±åŠ¨é—®é¢˜
  - âœ… macOS
  - âš ï¸ Windows - å¯ç”¨ä½†ç¼–è¯‘è¾ƒæ…¢ï¼Œå¯èƒ½é‡åˆ°é©±åŠ¨é—®é¢˜

- **ç¡¬ä»¶è¦æ±‚**:
  - è‡³å°‘ 8GB RAM
  - è‡³å°‘ 20GB å¯ç”¨ç£ç›˜ç©ºé—´
  - USB æ•°æ®çº¿ï¼ˆç”¨äºè¿æ¥ ESP32 å¼€å‘æ¿ï¼‰

---

## ğŸ› ï¸ å¼€å‘å·¥å…·å®‰è£…

### 1. å®‰è£…ä»£ç ç¼–è¾‘å™¨

æ¨èä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ç¼–è¾‘å™¨ï¼š

#### æ–¹æ¡ˆ A: Cursor (æ¨è)
```bash
# è®¿é—®å®˜ç½‘ä¸‹è½½
https://cursor.sh/
```

#### æ–¹æ¡ˆ B: Visual Studio Code
```bash
# è®¿é—®å®˜ç½‘ä¸‹è½½
https://code.visualstudio.com/
```

### 2. å®‰è£… ESP-IDF æ’ä»¶

åœ¨ Cursor æˆ– VSCode ä¸­ï¼š

1. æ‰“å¼€æ‰©å±•å¸‚åœºï¼ˆExtensionsï¼‰
2. æœç´¢ "ESP-IDF"
3. å®‰è£… **Espressif IDF** æ’ä»¶
4. é‡å¯ç¼–è¾‘å™¨

---

## ğŸ”§ ESP-IDF ç¯å¢ƒé…ç½®

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ ESP-IDF æ’ä»¶å®‰è£…ï¼ˆæ¨èæ–°æ‰‹ï¼‰

1. **æ‰“å¼€å‘½ä»¤é¢æ¿**
   - Windows/Linux: `Ctrl + Shift + P`
   - macOS: `Cmd + Shift + P`

2. **é…ç½® ESP-IDF**
   - è¾“å…¥å¹¶é€‰æ‹©: `ESP-IDF: Configure ESP-IDF Extension`
   - é€‰æ‹© **Express** å¿«é€Ÿå®‰è£…æ¨¡å¼

3. **é€‰æ‹© ESP-IDF ç‰ˆæœ¬**
   - **é‡è¦**: é€‰æ‹© **v5.4** æˆ–æ›´é«˜ç‰ˆæœ¬
   - ä¸‹è½½è·¯å¾„å»ºè®®ä½¿ç”¨é»˜è®¤è·¯å¾„

4. **ç­‰å¾…å®‰è£…å®Œæˆ**
   - é¦–æ¬¡å®‰è£…éœ€è¦ä¸‹è½½çº¦ 1-2GB æ–‡ä»¶
   - å®‰è£…æ—¶é—´å–å†³äºç½‘ç»œé€Ÿåº¦ï¼ˆ10-30åˆ†é’Ÿï¼‰

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£… ESP-IDF

#### Linux / macOS

```bash
# 1. å®‰è£…ä¾èµ–
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install git wget flex bison gperf python3 python3-pip python3-venv cmake ninja-build ccache libffi-dev libssl-dev dfu-util libusb-1.0-0

# macOS (éœ€è¦å…ˆå®‰è£… Homebrew)
brew install cmake ninja dfu-util

# 2. å…‹éš† ESP-IDF
mkdir -p ~/esp
cd ~/esp
git clone --recursive https://github.com/espressif/esp-idf.git
cd esp-idf
git checkout v5.4  # æˆ–æ›´é«˜ç‰ˆæœ¬

# 3. å®‰è£…å·¥å…·é“¾
./install.sh all

# 4. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¯æ¬¡æ‰“å¼€æ–°ç»ˆç«¯éƒ½éœ€è¦æ‰§è¡Œï¼‰
. $HOME/esp/esp-idf/export.sh

# å¯é€‰ï¼šå°†ä¸Šè¿°å‘½ä»¤æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc ä¸­è‡ªåŠ¨æ‰§è¡Œ
echo 'alias get_idf=". $HOME/esp/esp-idf/export.sh"' >> ~/.bashrc
```

#### Windows

```powershell
# ä¸‹è½½å¹¶è¿è¡Œ ESP-IDF å®‰è£…å™¨
# è®¿é—®: https://dl.espressif.com/dl/esp-idf/
# ä¸‹è½½æœ€æ–°çš„ ESP-IDF Tools Installer
# è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹© v5.4 æˆ–æ›´é«˜ç‰ˆæœ¬
```

---

## ğŸ“¦ é¡¹ç›®å…‹éš†ä¸é…ç½®

### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/78/xiaozhi-esp32.git
cd xiaozhi-esp32

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
git branch
# é»˜è®¤åœ¨ main åˆ†æ”¯ï¼ˆv2 ç‰ˆæœ¬ï¼‰
# å¦‚éœ€ä½¿ç”¨ v1 ç‰ˆæœ¬: git checkout v1
```

### 2. äº†è§£é¡¹ç›®ç»“æ„

```
xiaozhi-esp32/
â”œâ”€â”€ main/                    # ä¸»ç¨‹åºä»£ç 
â”‚   â”œâ”€â”€ boards/             # å„ç§å¼€å‘æ¿é…ç½®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”œâ”€â”€ scripts/                 # ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ partitions/             # åˆ†åŒºè¡¨é…ç½®
â”œâ”€â”€ CMakeLists.txt          # CMake é…ç½®
â”œâ”€â”€ sdkconfig.defaults      # é»˜è®¤ SDK é…ç½®
â””â”€â”€ README_zh.md            # ä¸­æ–‡è¯´æ˜æ–‡æ¡£
```

---

## ğŸ”¨ ç¼–è¯‘ä¸çƒ§å½•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

é€‚ç”¨äºå·²æœ‰ `config.json` çš„å¼€å‘æ¿ã€‚

```bash
# æŸ¥çœ‹æ”¯æŒçš„å¼€å‘æ¿
ls main/boards/

# ç¼–è¯‘æŒ‡å®šå¼€å‘æ¿ï¼ˆä¾‹å¦‚ï¼šç«‹åˆ›å®æˆ˜æ´¾ ESP32-S3ï¼‰
python scripts/release.py lichuang-s3-dev

# ç¼–è¯‘å®Œæˆåï¼Œå›ºä»¶ä½äº build/ ç›®å½•
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ idf.py æ‰‹åŠ¨ç¼–è¯‘

#### æ­¥éª¤ 1: è®¾ç½®ç›®æ ‡èŠ¯ç‰‡

```bash
# æ ¹æ®ä½ çš„å¼€å‘æ¿é€‰æ‹©å¯¹åº”çš„èŠ¯ç‰‡
# ESP32-S3
idf.py set-target esp32s3

# ESP32-C3
idf.py set-target esp32c3

# ESP32
idf.py set-target esp32

# ESP32-C6
idf.py set-target esp32c6

# ESP32-P4
idf.py set-target esp32p4
```

#### æ­¥éª¤ 2: é…ç½®é¡¹ç›®

```bash
# æ‰“å¼€é…ç½®èœå•
idf.py menuconfig
```

åœ¨èœå•ä¸­è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

1. **é€‰æ‹©å¼€å‘æ¿ç±»å‹**
   - å¯¼èˆªåˆ°: `Xiaozhi Assistant` â†’ `Board Type`
   - é€‰æ‹©ä½ çš„å¼€å‘æ¿å‹å·

2. **é…ç½® Wi-Fiï¼ˆå¯é€‰ï¼‰**
   - å¯¼èˆªåˆ°: `Xiaozhi Assistant` â†’ `Wi-Fi Configuration`
   - è¾“å…¥ Wi-Fi SSID å’Œå¯†ç 

3. **å…¶ä»–é…ç½®**
   - Flash å¤§å°: `Serial flasher config` â†’ `Flash size`
   - åˆ†åŒºè¡¨: `Partition Table` â†’ `Custom partition table CSV`

4. **ä¿å­˜å¹¶é€€å‡º**
   - æŒ‰ `S` ä¿å­˜
   - æŒ‰ `Q` é€€å‡º

#### æ­¥éª¤ 3: ç¼–è¯‘é¡¹ç›®

```bash
# å®Œå…¨æ¸…ç†ï¼ˆé¦–æ¬¡ç¼–è¯‘æˆ–æ›´æ¢èŠ¯ç‰‡åï¼‰
idf.py fullclean

# ç¼–è¯‘
idf.py build
```

ç¼–è¯‘æˆåŠŸåä¼šæ˜¾ç¤ºï¼š
```
Project build complete. To flash, run:
idf.py -p PORT flash
```

#### æ­¥éª¤ 4: çƒ§å½•å›ºä»¶

```bash
# æŸ¥æ‰¾ä¸²å£è®¾å¤‡
# Linux: ls /dev/ttyUSB* æˆ– ls /dev/ttyACM*
# macOS: ls /dev/cu.*
# Windows: è®¾å¤‡ç®¡ç†å™¨æŸ¥çœ‹ COM ç«¯å£

# çƒ§å½•å›ºä»¶ï¼ˆæ›¿æ¢ PORT ä¸ºå®é™…ç«¯å£ï¼‰
# Linux/macOS ç¤ºä¾‹
idf.py -p /dev/ttyUSB0 flash

# Windows ç¤ºä¾‹
idf.py -p COM3 flash

# çƒ§å½•å¹¶ç›‘æ§ä¸²å£è¾“å‡º
idf.py -p /dev/ttyUSB0 flash monitor
```

#### æ­¥éª¤ 5: ç›‘æ§æ—¥å¿—

```bash
# æŸ¥çœ‹ä¸²å£æ—¥å¿—
idf.py -p /dev/ttyUSB0 monitor

# é€€å‡ºç›‘æ§: Ctrl + ]
```

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### å®Œæ•´æµç¨‹ï¼ˆä»¥ ESP32-S3 ä¸ºä¾‹ï¼‰

```bash
# 1. æ¿€æ´» ESP-IDF ç¯å¢ƒï¼ˆå¦‚æœä½¿ç”¨æ‰‹åŠ¨å®‰è£…ï¼‰
. $HOME/esp/esp-idf/export.sh

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd xiaozhi-esp32

# 3. è®¾ç½®ç›®æ ‡èŠ¯ç‰‡
idf.py set-target esp32s3

# 4. é…ç½®é¡¹ç›®
idf.py menuconfig
# é€‰æ‹©å¼€å‘æ¿ç±»å‹åä¿å­˜é€€å‡º

# 5. ç¼–è¯‘
idf.py build

# 6. çƒ§å½•ï¼ˆæ›¿æ¢ä¸ºå®é™…ç«¯å£ï¼‰
idf.py -p /dev/ttyUSB0 flash monitor
```

---

## â“ å¸¸è§é—®é¢˜

### 1. ç¼–è¯‘é”™è¯¯ï¼šæ‰¾ä¸åˆ° ESP-IDF

**é—®é¢˜**: `ESP-IDF environment not found`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿å·²æ¿€æ´» ESP-IDF ç¯å¢ƒ
. $HOME/esp/esp-idf/export.sh

# æˆ–åœ¨ VSCode/Cursor ä¸­ä½¿ç”¨ ESP-IDF æ’ä»¶çš„ç»ˆç«¯
```

### 2. ä¸²å£æƒé™é—®é¢˜ï¼ˆLinuxï¼‰

**é—®é¢˜**: `Permission denied: '/dev/ttyUSB0'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ° dialout ç»„
sudo usermod -a -G dialout $USER

# é‡æ–°ç™»å½•æˆ–é‡å¯ç³»ç»Ÿä½¿æ›´æ”¹ç”Ÿæ•ˆ
```

### 3. é©±åŠ¨é—®é¢˜ï¼ˆWindowsï¼‰

**é—®é¢˜**: æ— æ³•è¯†åˆ« ESP32 è®¾å¤‡

**è§£å†³æ–¹æ¡ˆ**:
1. ä¸‹è½½å¹¶å®‰è£… CP210x æˆ– CH340 é©±åŠ¨
2. æ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨ä¸­æ˜¯å¦æ˜¾ç¤º COM ç«¯å£
3. å°è¯•æ›´æ¢ USB æ•°æ®çº¿ï¼ˆå¿…é¡»æ˜¯æ•°æ®çº¿ï¼Œä¸èƒ½æ˜¯å……ç”µçº¿ï¼‰

### 4. ç¼–è¯‘é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯ç”¨ ccache åŠ é€Ÿç¼–è¯‘
idf.py menuconfig
# å¯¼èˆªåˆ°: Compiler options â†’ Enable ccache

# Linux ç”¨æˆ·å¯ä»¥å¢åŠ å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°
idf.py build -j8  # 8 ä¸º CPU æ ¸å¿ƒæ•°
```

### 5. Flash ç©ºé—´ä¸è¶³

**é—®é¢˜**: `Error: Not enough space in flash`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å¼€å‘æ¿çš„ Flash å¤§å°ï¼ˆé€šå¸¸ä¸º 4MBã€8MB æˆ– 16MBï¼‰
2. åœ¨ `menuconfig` ä¸­è®¾ç½®æ­£ç¡®çš„ Flash å¤§å°
3. é€‰æ‹©å¯¹åº”çš„åˆ†åŒºè¡¨ï¼ˆ`partitions/v2/4m.csv` æˆ– `8m.csv`ï¼‰

### 6. OTA å‡çº§é—®é¢˜

**æ³¨æ„**: v1 å’Œ v2 ç‰ˆæœ¬åˆ†åŒºè¡¨ä¸å…¼å®¹

- ä» v1 å‡çº§åˆ° v2 å¿…é¡»æ‰‹åŠ¨çƒ§å½•å›ºä»¶ï¼Œæ— æ³•é€šè¿‡ OTA
- v1 ç¨³å®šç‰ˆæœ¬ä¸º 1.9.2ï¼Œå¯é€šè¿‡ `git checkout v1` åˆ‡æ¢

---

## ğŸ“š è¿›é˜¶èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [ESP-IDF ç¼–ç¨‹æŒ‡å—](https://docs.espressif.com/projects/esp-idf/)
- [å°æ™º AI ç™¾ç§‘å…¨ä¹¦](https://ccnphfhqs21z.feishu.cn/wiki/F5krwD16viZoF0kKkvDcrZNYnhb)

### å¼€å‘è€…æ–‡æ¡£
- [è‡ªå®šä¹‰å¼€å‘æ¿æŒ‡å—](docs/custom-board.md)
- [MCP åè®®ä½¿ç”¨è¯´æ˜](docs/mcp-usage.md)
- [WebSocket é€šä¿¡åè®®](docs/websocket.md)
- [MQTT+UDP æ··åˆé€šä¿¡åè®®](docs/mqtt-udp.md)

### ç¤¾åŒºæ”¯æŒ
- QQ ç¾¤: 1011329060
- GitHub Issues: https://github.com/78/xiaozhi-esp32/issues

---

## ğŸ¨ ä»£ç è§„èŒƒ

æœ¬é¡¹ç›®ä½¿ç”¨ **Google C++ ä»£ç é£æ ¼**

æäº¤ä»£ç å‰è¯·ç¡®ä¿ï¼š
1. ä»£ç æ ¼å¼ç¬¦åˆ Google C++ Style Guide
2. é€šè¿‡ç¼–è¯‘æµ‹è¯•
3. æ·»åŠ å¿…è¦çš„æ³¨é‡Š

---

## âœ… éªŒè¯å®‰è£…

å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… æˆåŠŸç¼–è¯‘é¡¹ç›®
- âœ… çƒ§å½•å›ºä»¶åˆ°å¼€å‘æ¿
- âœ… åœ¨ä¸²å£ç›‘è§†å™¨ä¸­çœ‹åˆ°å¯åŠ¨æ—¥å¿—
- âœ… è®¾å¤‡æˆåŠŸè¿æ¥ Wi-Fi
- âœ… è®¾å¤‡è¿æ¥åˆ° xiaozhi.me æœåŠ¡å™¨

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é…ç½®æœåŠ¡å™¨**: ç™»å½• [xiaozhi.me](https://xiaozhi.me) é…ç½®å¤§æ¨¡å‹
2. **è‡ªå®šä¹‰å¼€å‘æ¿**: å‚è€ƒ [è‡ªå®šä¹‰å¼€å‘æ¿æŒ‡å—](docs/custom-board.md)
3. **å­¦ä¹  MCP åè®®**: æŸ¥çœ‹ [MCP ä½¿ç”¨æ–‡æ¡£](docs/mcp-usage.md)
4. **åŠ å…¥ç¤¾åŒº**: åœ¨ QQ ç¾¤äº¤æµç»éªŒ

---

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨ GitHub æ Issue æˆ–åŠ å…¥ QQ ç¾¤è®¨è®ºã€‚
